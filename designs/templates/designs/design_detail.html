{% extends "page.html" %}
{% load staticfiles thumbnail %}

{% block title %}查看设计方案{% endblock %}

{% block extracss %}
<link rel="stylesheet" href="{% static 'css/design.css' %}">
{% endblock%}

{% block extrajs %}
<script src="{% static 'js/design-user.js' %}"></script>
{% endblock%}

{% block content %}

<div class="container body">
    <div class="row">
        <div class="col-md-12 content">
            <p>
                <span>订单号：<a href="{% url 'orders:detail' code=object.order.code %}">{{ object.order.code }}</a></span>
                <span class="pull-right">
                    {% if object.status == 'waiting' and user == object.client %}
                        <a href="javascript:void(0)" class="reject-btn" data-toggle="popover" data-html="true" data-placement="bottom" data-title="请告诉我们原因" data-content='<form id="reject-form" action="{% url "designs:reject" code=design.code %}" method="post"><input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}" /><textarea name="reject_reason" class="form-control" rows="5"></textarea><br /><button type="submit" class="btn btn-default btn-sm pull-right">提交</button></form>'>再帮我设计一套</a> 
                        <a class="btn btn-primary" href="{% url 'designs:accept' code=design.code %}">选择这套方案</a>
                    {% else %}
                        <span>状态：{{ object.get_status_display }}</span>
                    {% endif %}
                </span>
            </p>
            <hr />
            <div id="design-comments">
                <p>
                    <img width="50" class="avatar" src="{{ object.designer.profile.avatar|thumbnail_url:'small' }}" />
                    <span>{{ object.comment }}</span>
                </p>
                {% if object.status == 'rejected' %}
                <p>
                    <img width="50" class="avatar" src="{{ object.client.profile.avatar|thumbnail_url:'small' }}" />
                    <span>{{ object.reject_reason }}</span>
                </p>
                {% endif %}
            </div>
            <hr />
            <div class="row">
                {% for design_clothing in object.clothings.all %}
                <div class="col-sm-3">
                    <div class="row">
                        <div class="col-sm-12 text-center">
                            <img src="{{ design_clothing.clothing.image|thumbnail_url:'small' }}" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <span>颜色：<b>{{ design_clothing.color }}</b></span>
                            <span>尺寸：<b>{{ design_clothing.size }}</b></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <span>{{ design_clothing.clothing.name }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <hr />
            <div class="row">
                {% for photo in object.photos.all %}
                <div class="col-sm-3">
                    <img width="200" src="{{ photo.file|thumbnail_url:'medium' }}" />
                    <p class="text-center"><a target="_blank" href="{{ MEDIA_URL }}{{ photo.file }}">查看大图</a></p>
                </div>
                {% endfor %}
            </div>
            <hr >
            <div>
                <span class="pull-right">
                    {% if object.status == 'waiting' and user == object.client %}
                        <a href="javascript:void(0)" class="reject-btn" data-toggle="popover" data-html="true" data-placement="top" data-title="请告诉我们原因" data-content='<form id="reject-form" action="{% url "designs:reject" code=design.code %}" method="post"><input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}" /><textarea name="reject_reason" class="form-control" rows="5"></textarea><br /><button type="submit" class="btn btn-default btn-sm pull-right">提交</button></form>'>再帮我设计一套</a> 
                        <a class="btn btn-primary" href="{% url 'designs:accept' code=design.code %}">选择这套方案</a>
                    {% else %}
                        <span>状态：{{ object.get_status_display }}</span>
                    {% endif %}
                </span>
            </div>
        </div>
    </div>
</div>

{% endblock %}
