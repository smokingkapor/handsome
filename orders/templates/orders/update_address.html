{% extends "accounts/user_center.html" %}
{% load staticfiles account_tags thumbnail %}

{% block more_extrajs_compress %}
<script src="{% static 'js/order.js' %}"></script>
{% endblock%}

{% block more_extracss_compress %}
<link rel="stylesheet" href="{% static 'css/order.css' %}">
{% endblock%}

{% block user_center_content %}
<div id="order-address" class="container">
    <div class="row">
        <div class="col-md-8 col-md-offset-2 content">
            <br />
            <h4><b>收货地址</b></h4>
            <hr />
            {% if address %}
            <div id="full-adress">
                <table class="table table-bordered">
                    <tr>
                        <td class="name">收货人：</td>
                        <td class="nickname">{{ address.name }}</td>
                    </tr>
                    <tr>
                        <td class="name">联系电话：</td>
                        <td class="phone">{{ address.phone }}</td>
                    </tr>
                    <tr>
                        <td class="name">所在地区：</td>
                        <td class="region">{{ address.get_region }}</td>
                    </tr>
                    <tr>
                        <td class="name">详细地址：</td>
                        <td name="house">{{ address.house }}</td>
                    </tr>
                </table>
                <p class="text-right"><a href="javascript:void(0)" class="btn btn-primary" id="edit-address-btn">修改</a></p>
            </div>
            {% endif %}
            <form class="form-horizontal delivery" role="form">
                <input type="hidden" id="address-pk" value="{{ address.id }}" />
                {% comment %}
                <p id="full-adress" {% if not address %}class="hidden"{% endif %}>
                    <span>{{ address|default_if_none:'' }}</span>
                    <a href="javascript:void(0)" id="edit-address-btn"><span class="glyphicon glyphicon-edit"></span>修改</a>
                </p>
                {% endcomment %}
                <div id="address-edit-panel" {% if address %}class="hidden"{% endif %}>
                    <div class="form-group">
                        <small class="col-sm-3 control-label"><b class="text-danger">*</b>收货人：</small>
                        <div class="col-sm-6">
                            <input id="name" class="form-control input-sm" value="{{ address.name }}" />
                        </div>
                    </div>
                    <div class="form-group">
                        <small class="col-sm-3 control-label"><b class="text-danger">*</b>所在地区：</small>
                        <div id="address-area" class="col-sm-9">
                          <div class="row">
                            <div class="col-sm-4">
                              <select id="province" class="form-control input-sm address" data-target="#city" data-url="{% url 'orders:load_address' %}?level=city">
                                  <option value="-1">--请选择--</option>
                                  {% for province in provinces %}
                                      {% if province == address.province %}
                                          <option value="{{ province.id }}" selected="selected">{{ province.name }}</option>
                                      {% else %}
                                          <option value="{{ province.id }}">{{ province.name }}</option>
                                      {% endif %}
                                  {% endfor %}
                              </select>
                            </div>
                            <div class="col-sm-4">
                              <select id="city" class="form-control input-sm address {% if not address.city %}hidden{% endif %}" data-target="#country" data-url="{% url 'orders:load_address' %}?level=country">
                                  <option value="-1">--请选择--</option>
                                  {% for city in address.province.city_set.all %}
                                      {% if city == address.city %}
                                          <option value="{{ city.id }}" selected="selected">{{ city.name }}</option>
                                      {% else %}
                                          <option value="{{ city.id }}">{{ city.name }}</option>
                                      {% endif %}
                                  {% endfor %}
                              </select>
                            </div>
                            <div class="col-sm-4">
                              <select id="country" class="form-control input-sm address {% if not address.country %}hidden{% endif %}" data-target="#town" data-url="{% url 'orders:load_address' %}?level=town">
                                  <option value="-1">--请选择--</option>
                                  {% for country in address.city.country_set.all %}
                                      {% if country == address.country %}
                                          <option value="{{ country.id }}" selected="selected">{{ country.name }}</option>
                                      {% else %}
                                          <option value="{{ country.id }}">{{ country.name }}</option>
                                      {% endif %}
                                  {% endfor %}
                              </select>
                            </div>
                          </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <small class="col-sm-3 control-label"><b class="text-danger">*</b>详细地址：</small>
                            <div class="col-sm-9">
                                <span id="region">{{ address.get_region }}</span>
                                <input id="house" class="form-control input-sm" value="{{ address.house }}" />
                            </div>
                    </div>
                    <div class="form-group">
                        <small class="col-sm-3 control-label"><b class="text-danger">*</b>手机号：</small>
                        <div class="col-sm-6">
                            <input id="phone" class="form-control input-sm" value="{% if address.phone %}{{ address.phone }}{% elif user.profile.phone %}{{ user.profile.phone }}{% endif %}" />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-3 col-sm-10">
                            <button id="save-address-btn" type="button" data-url="{% url 'orders:save_address' %}" class="btn btn-primary">保存配送信息</button>
                            {% if address %}
                            <a id="cancel-edit-address-btn" href="javascript:void(0)">取消</a>
                            {% endif %}
                            <br />
                            <br />
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
